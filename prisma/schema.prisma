generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model activity_logs {
  id         String   @id
  tenantId   String
  userId     String?
  action     String
  entityType String?
  entityId   String?
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  tenants    tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users      users?   @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([tenantId])
  @@index([userId])
}

model articles {
  id              String    @id
  tenantId        String
  title           String
  slug            String    @unique
  excerpt         String?
  content         String?
  category        String?
  tags            Json?
  featuredImage   String?
  metaTitle       String?
  metaDescription String?
  isPublished     Boolean   @default(false)
  publishedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  tenants         tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([slug])
  @@index([tenantId])
}

model case_studies {
  id               String    @id
  tenantId         String
  title            String
  slug             String    @unique
  summary          String?
  content          String?
  projectName      String
  savingsAmount    Int?
  participantCount Int?
  discountPercent  Float?
  featuredImage    String?
  images           Json?
  isPublished      Boolean   @default(false)
  publishedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  tenants          tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([slug])
  @@index([tenantId])
}

model faqs {
  id        String   @id
  question  String
  answer    String
  category  String?
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model group_members {
  id               String           @id
  groupId          String
  userId           String
  commitmentStatus CommitmentStatus @default(INTERESTED)
  paymentReference String?
  notes            String?
  joinedAt         DateTime         @default(now())
  updatedAt        DateTime
  groups           groups           @relation(fields: [groupId], references: [id], onDelete: Cascade)
  users            users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model group_milestones {
  id          String   @id
  groupId     String
  title       String
  description String?
  type        String
  metadata    Json?
  createdAt   DateTime @default(now())
  groups      groups   @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
}

model groups {
  id                 String             @id
  tenantId           String
  projectId          String
  name               String
  description        String?
  targetBuyersCount  Int
  currentBuyersCount Int                @default(0)
  status             GroupStatus        @default(DRAFT)
  negotiatedDiscount Float?
  specialTerms       String?
  deadline           DateTime?
  negotiationStart   DateTime?
  negotiationEnd     DateTime?
  closingDate        DateTime?
  commitmentAmount   Int?
  createdById        String
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  group_members      group_members[]
  group_milestones   group_milestones[]
  users              users              @relation(fields: [createdById], references: [id])
  projects           projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenants            tenants            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  offers             offers[]
  transactions       transactions[]

  @@index([projectId])
  @@index([status])
  @@index([tenantId])
}

model inventory_units {
  id             String           @id
  projectId      String
  unitType       String
  unitNumber     String?
  floor          Int?
  tower          String?
  carpetArea     Int?
  builtUpArea    Int?
  price          Int
  availability   UnitAvailability @default(AVAILABLE)
  specifications Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  projects       projects         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([availability])
  @@index([projectId])
}

model notifications {
  id        String           @id
  userId    String
  type      NotificationType
  title     String
  message   String
  linkUrl   String?
  isRead    Boolean          @default(false)
  metadata  Json?
  createdAt DateTime         @default(now())
  users     users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isRead])
  @@index([userId])
}

model offers {
  id              String   @id
  groupId         String
  offerType       String
  discountPercent Float
  minBuyers       Int?
  specialTerms    String?
  notes           String?
  isAccepted      Boolean  @default(false)
  createdAt       DateTime @default(now())
  groups          groups   @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
}

model project_shortlists {
  id        String   @id
  userId    String
  projectId String
  createdAt DateTime @default(now())
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, projectId])
}

model projects {
  id                 String               @id
  tenantId           String
  name               String
  slug               String               @unique
  description        String?
  developer          String
  city               String
  location           String
  latitude           Float?
  longitude          Float?
  address            String?
  priceRangeMin      Int?
  priceRangeMax      Int?
  totalUnits         Int?
  availableUnits     Int?
  images             Json?
  videos             Json?
  brochureUrl        String?
  floorPlansUrl      String?
  amenities          Json?
  specifications     Json?
  status             ProjectStatus        @default(DRAFT)
  featured           Boolean              @default(false)
  launchDate         DateTime?
  completionDate     DateTime?
  metaTitle          String?
  metaDescription    String?
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  groups             groups[]
  inventory_units    inventory_units[]
  project_shortlists project_shortlists[]
  tenants            tenants              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([city])
  @@index([slug])
  @@index([status])
  @@index([tenantId])
}

model saved_searches {
  id           String   @id
  userId       String
  name         String
  filters      Json
  alertEnabled Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model tenants {
  id                 String          @id
  name               String
  slug               String          @unique
  plan               String          @default("free")
  billingEmail       String?
  stripeCustomerId   String?         @unique
  subscriptionStatus String?
  settings           Json?
  isActive           Boolean         @default(true)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime
  activity_logs      activity_logs[]
  articles           articles[]
  case_studies       case_studies[]
  groups             groups[]
  projects           projects[]
  transactions       transactions[]
  users              users[]

  @@index([slug])
}

model transactions {
  id                    String            @id
  tenantId              String
  userId                String
  groupId               String?
  type                  TransactionType
  amount                Int
  currency              String            @default("INR")
  status                TransactionStatus @default(PENDING)
  stripePaymentIntentId String?           @unique
  stripeChargeId        String?
  stripeRefundId        String?
  description           String?
  metadata              Json?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  groups                groups?           @relation(fields: [groupId], references: [id])
  tenants               tenants           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users                 users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model users {
  id                 String               @id
  tenantId           String
  email              String               @unique
  emailVerified      DateTime?
  name               String?
  phone              String?
  phoneVerified      Boolean              @default(false)
  image              String?
  password           String?
  role               UserRole             @default(BUYER)
  kycStatus          KYCStatus            @default(NOT_STARTED)
  kycDocuments       Json?
  isActive           Boolean              @default(true)
  lastLoginAt        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  accounts           accounts[]
  activity_logs      activity_logs[]
  group_members      group_members[]
  groups             groups[]
  notifications      notifications[]
  project_shortlists project_shortlists[]
  saved_searches     saved_searches[]
  sessions           sessions[]
  transactions       transactions[]
  tenants            tenants              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([role])
  @@index([tenantId])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum CommitmentStatus {
  INTERESTED
  COMMITTED
  PAID
  REFUNDED
  WITHDRAWN
}

enum GroupStatus {
  DRAFT
  OPEN
  NEGOTIATING
  FINALIZED
  CLOSED
}

enum KYCStatus {
  NOT_STARTED
  IN_PROGRESS
  APPROVED
  REJECTED
}

enum NotificationType {
  GROUP_UPDATE
  NEGOTIATION_MILESTONE
  PAYMENT_REMINDER
  NEW_PROJECT
  SYSTEM
}

enum ProjectStatus {
  DRAFT
  PRE_LAUNCH
  ACTIVE
  FAST_SELLING
  SOLD_OUT
  COMPLETED
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum TransactionType {
  COMMITMENT_FEE
  BOOKING_AMOUNT
  EMD
  REFUND
  SUBSCRIPTION
}

enum UnitAvailability {
  AVAILABLE
  RESERVED
  SOLD
  BLOCKED
}

enum UserRole {
  BUYER
  ORGANIZER
  PARTNER_ADMIN
  SUPER_ADMIN
}
